<launch>
	<include file="$(find tinker_navigation)/launch/rs_vins.launch"/>

	<!-- <node pkg="vins" type="vins_node" name="vins_rs_1">
		<param name="config_file" value="/home/hazel/VINS_ws/src/VINS-Fusion/config/realsense_d435i/realsense_stereo_imu_config.yaml"/>
	</node> -->

	<node pkg="vins" type="loop_fusion" name="vins_loop_fusion_node">
		<param name="config_file" value="/home/hazel/VINS_ws/src/VINS-Fusion/config/realsense_d435i/realsense_stereo_imu_config.yaml"/>
	</node>
	<node pkg="nodelet" type="nodelet" name="pcl_manager" args="manager" output="screen" />

	<!-- Run a VoxelGrid filter to clean NaNs and downsample the data -->
	<!-- Range:0.01-1.35m voxel_size:0.02m -->
	<node pkg="nodelet" type="nodelet" name="voxel_grid" args="load pcl/VoxelGrid pcl_manager" output="screen">
		<remap from="~input" to="/camera/depth/color/points" />
		<rosparam>
        filter_field_name: z
        filter_limit_min: 0.01
        filter_limit_max: 1.35
        filter_limit_negative: False
        leaf_size: 0.02
		</rosparam>
	</node>

	<node pkg="nodelet" type="nodelet" name="obstacles_detection" args="load rtabmap_ros/obstacles_detection pcl_manager" output="screen">
		<remap from="cloud" to="/voxel_grid/output"/>
		<remap from="obstacles" to="/obstacles"/>
		<remap from="ground" to="/ground"/>

		<param name="frame_id" type="string" value="base_link"/>
		<param name="map_frame_id" type="string" value="cloud_map"/>
		<!-- <param name="wait_for_transform" type="bool" value="true"/> -->
		<param name="Grid/MinClusterSize" type="int" value="10"/>
		<param name="Grid/MaxObstacleHeight" type="double" value="1.35"/>
	</node>

	<node pkg="tf" type="static_transform_publisher" name="world_trans" args="0 0 0 0 0 0 world camera_link 10" />
	<include file="$(find vins)/launch/vins_rviz.launch"/>

</launch>